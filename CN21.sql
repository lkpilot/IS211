-- Tao chi nhanh 2
CREATE USER CN2 IDENTIFIED BY CN2;
GRANT CONNECT, DBA TO CN2; 
GRANT CREATE PUBLIC DATABASE LINK TO CN2;

-- Thiet ke csdl tai CN2
CREATE TABLE CN2.CHINHANH (
    MACN VARCHAR2(10) PRIMARY KEY,
    TENCN VARCHAR2(50) UNIQUE,
    DIACHI VARCHAR2(100)
);

CREATE TABLE CN2.KHACHHANG (
    MAKH VARCHAR2(10) PRIMARY KEY,
    TENKH VARCHAR2(50),
    SDT VARCHAR2(15) UNIQUE,
    NGTG DATE,
    DOANHSO NUMBER,
    DTL NUMBER
);

CREATE TABLE CN2.NHANVIEN (
    MANV VARCHAR2(10) PRIMARY KEY,
    TENNV VARCHAR2(50),
    NGVL DATE,
    SDT VARCHAR2(15),
    CHUCVU VARCHAR2(20) CHECK (CHUCVU IN ('Thu ngan', 'Boi ban', 'Quan ly')),
    LUONG NUMBER,
    TINHTRANG VARCHAR2(20) CHECK (TINHTRANG IN ('Dang lam viec', 'Da nghi viec')),
    MACN VARCHAR2(10),
    FOREIGN KEY (MACN) REFERENCES CHINHANH(MACN)
);

CREATE TABLE CN2.MONAN (
    MAMA VARCHAR2(10) PRIMARY KEY,
    TENMON VARCHAR2(50),
    DONGIA NUMBER,
    MOTA VARCHAR2(200),
    LOAIMA VARCHAR2(50)
);

CREATE TABLE CN2.BAN (
    MABAN VARCHAR2(10) PRIMARY KEY,
    TENBAN VARCHAR2(50),
    TRANGTHAI VARCHAR2(50) CHECK (TRANGTHAI IN ('Dang dung bua', 'Da dat truoc', 'Dang trong'))
);

CREATE TABLE CN2.HDCHINHANH_QL (
    MAHD VARCHAR2(10) PRIMARY KEY,
    MAKH VARCHAR2(10),
    NGHD DATE,
    TONGTIEN NUMBER,
    MACN VARCHAR2(10),
    FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
    FOREIGN KEY (MACN) REFERENCES CHINHANH(MACN)
);

CREATE TABLE CN2.HDCHINHANH_NV (
    MAHD VARCHAR2(10) PRIMARY KEY,
    MANV1 VARCHAR2(10),
    MANV2 VARCHAR2(10),
    MABAN VARCHAR2(10),
    MACN VARCHAR2(10),
    FOREIGN KEY (MANV1) REFERENCES NHANVIEN(MANV),
    FOREIGN KEY (MANV2) REFERENCES NHANVIEN(MANV),
    FOREIGN KEY (MABAN) REFERENCES BAN(MABAN),
    FOREIGN KEY (MACN) REFERENCES CHINHANH(MACN)
);

CREATE TABLE CN2.CTHD (
    MAHD VARCHAR2(10),
    MAMA VARCHAR2(10),
    SL NUMBER,
    DONGIA NUMBER,
    PRIMARY KEY (MAHD, MAMA),
    FOREIGN KEY (MAHD) REFERENCES HDCHINHANH_QL(MAHD),
    FOREIGN KEY (MAMA) REFERENCES MONAN(MAMA)
);

-- Them du lieu tai CN2
-- CHINHANH
INSERT INTO CN2.CHINHANH VALUES ('CN2','Dreamers, Binh Duong', 'Di An, Binh Duong');

-- KHACHHANG
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH001', 'Nguyen Van A', '0901234567', TO_DATE('2023-01-01', 'YYYY-MM-DD'), 1500000, 10);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH002', 'Tran Thi B', '0912345678', TO_DATE('2023-02-15', 'YYYY-MM-DD'), 2000000, 15);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH003', 'Le Van C', '0923456789', TO_DATE('2023-03-20', 'YYYY-MM-DD'), 1800000, 12);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH004', 'Pham Thi D', '0934567890', TO_DATE('2023-04-10', 'YYYY-MM-DD'), 2200000, 18);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH005', 'Hoang Van E', '0945678901', TO_DATE('2023-05-05', 'YYYY-MM-DD'), 2500000, 20);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH006', 'Nguyen Thi F', '0956789012', TO_DATE('2023-06-12', 'YYYY-MM-DD'), 3000000, 25);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH007', 'Tran Van G', '0967890123', TO_DATE('2023-07-18', 'YYYY-MM-DD'), 2800000, 22);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH008', 'Le Thi H', '0978901234', TO_DATE('2023-08-25', 'YYYY-MM-DD'), 3300000, 30);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH009', 'Pham Van I', '0989012345', TO_DATE('2023-09-30', 'YYYY-MM-DD'), 2700000, 24);
INSERT INTO CN2.KHACHHANG (MAKH, TENKH, SDT, NGTG, DOANHSO, DTL) VALUES
('KH010', 'Ho Thi K', '0990123456', TO_DATE('2023-10-05', 'YYYY-MM-DD'), 3200000, 28);

-- NHANVIEN
INSERT INTO CN2.NHANVIEN (MANV, TENNV, NGVL, SDT, CHUCVU, LUONG, TINHTRANG, MACN) VALUES
('NV006', 'Tran Van I', TO_DATE('2022-06-01', 'YYYY-MM-DD'), '0987654321', 'Thu ngan', 12000000, 'Dang lam viec', 'CN2');
INSERT INTO CN2.NHANVIEN (MANV, TENNV, NGVL, SDT, CHUCVU, LUONG, TINHTRANG, MACN) VALUES
('NV007', 'Nguyen Van K', TO_DATE('2022-07-15', 'YYYY-MM-DD'), '0976543210', 'Boi ban', 10000000, 'Dang lam viec', 'CN2');
INSERT INTO CN2.NHANVIEN (MANV, TENNV, NGVL, SDT, CHUCVU, LUONG, TINHTRANG, MACN) VALUES
('NV008', 'Le Thi L', TO_DATE('2022-08-20', 'YYYY-MM-DD'), '0965432109', 'Quan ly', 15000000, 'Da nghi viec', 'CN2');
INSERT INTO CN2.NHANVIEN (MANV, TENNV, NGVL, SDT, CHUCVU, LUONG, TINHTRANG, MACN) VALUES
('NV009', 'Pham Van M', TO_DATE('2022-09-10', 'YYYY-MM-DD'), '0954321098', 'Thu ngan', 12000000, 'Dang lam viec', 'CN2');
INSERT INTO CN2.NHANVIEN (MANV, TENNV, NGVL, SDT, CHUCVU, LUONG, TINHTRANG, MACN) VALUES
('NV010', 'Hoang Thi N', TO_DATE('2022-10-05', 'YYYY-MM-DD'), '0943210987', 'Boi ban', 10000000, 'Dang lam viec', 'CN2');

-- MONAN
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA001', 'Bun rieu', 35000, 'Bun rieu cay nong, nuoc dung thom ngon', 'Mi, Bun');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA002', 'Com chien', 25000, 'Com chien hap dan, co them rau song', 'Com');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA003', 'Pho bo', 40000, 'Pho bo nuoc dung dam da, thit mem', 'Mi, Bun');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA004', 'Goi cuon', 30000, 'Goi cuon tuoi ngon, nhe nhang', 'Goi cuon');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA005', 'Banh mi chao', 28000, 'Banh mi chao gion thom, an kem sot', 'Banh mi');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA006', 'Banh xeo', 32000, 'Banh xeo nuoc mam pha chua ngot', 'Banh xeo');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA007', 'Com nieu', 30000, 'Com nieu hap dan, thom phuc', 'Com');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA008', 'Hu tieu', 38000, 'Hu tieu nuoc dung dam da, an kem rau song', 'Mi, Bun');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA009', 'Nem cuon', 32000, 'Nem cuon tuoi ngon, an kem nuoc mam pha chua ngot', 'Nem cuon');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES
('MA010', 'Bun thit nuong', 35000, 'Bun thit nuong banh trang, an kem gia vi', 'Mi, Bun');
INSERT INTO CN2.MONAN (MAMA, TENMON, DONGIA, MOTA, LOAIMA) VALUES ('MA011', 'Mi xao', 50000, 'Mi xao ngon', 'Mi');

-- BAN
INSERT INTO CN2.BAN (MABAN, TENBAN, TRANGTHAI) VALUES
('B006', 'Ban 6', 'Dang trong');
INSERT INTO CN2.BAN (MABAN, TENBAN, TRANGTHAI) VALUES
('B007', 'Ban 7', 'Dang trong');
INSERT INTO CN2.BAN (MABAN, TENBAN, TRANGTHAI) VALUES
('B008', 'Ban 8', 'Dang trong');
INSERT INTO CN2.BAN (MABAN, TENBAN, TRANGTHAI) VALUES
('B009', 'Ban 9', 'Da dat truoc');
INSERT INTO CN2.BAN (MABAN, TENBAN, TRANGTHAI) VALUES
('B010', 'Ban 10', 'Dang dung bua');

-- HDCHINHANH_QL
INSERT INTO CN2.HDCHINHANH_QL (MAHD, MAKH, NGHD, TONGTIEN, MACN) VALUES
('HD006', 'KH006', TO_DATE('2023-06-29', 'YYYY-MM-DD'), 128000, 'CN2');
INSERT INTO CN2.HDCHINHANH_QL (MAHD, MAKH, NGHD, TONGTIEN, MACN) VALUES
('HD007', 'KH007', TO_DATE('2023-07-20', 'YYYY-MM-DD'), 261000, 'CN2');
INSERT INTO CN2.HDCHINHANH_QL (MAHD, MAKH, NGHD, TONGTIEN, MACN) VALUES
('HD008', 'KH008', TO_DATE('2023-08-25', 'YYYY-MM-DD'), 180000, 'CN2');
INSERT INTO CN2.HDCHINHANH_QL (MAHD, MAKH, NGHD, TONGTIEN, MACN) VALUES
('HD009', 'KH009', TO_DATE('2023-09-18', 'YYYY-MM-DD'), 110000, 'CN2');
INSERT INTO CN2.HDCHINHANH_QL (MAHD, MAKH, NGHD, TONGTIEN, MACN) VALUES
('HD010', 'KH010', TO_DATE('2023-10-04', 'YYYY-MM-DD'), 140000, 'CN2');

-- HDCHINHANH_NV
INSERT INTO CN2.HDCHINHANH_NV (MAHD, MANV1, MANV2, MABAN, MACN) VALUES
('HD006', 'NV006', 'NV007', 'B006', 'CN2');
INSERT INTO CN2.HDCHINHANH_NV (MAHD, MANV1, MANV2, MABAN, MACN) VALUES
('HD007', 'NV007', 'NV009', 'B007', 'CN2');
INSERT INTO CN2.HDCHINHANH_NV (MAHD, MANV1, MANV2, MABAN, MACN) VALUES
('HD008', 'NV006', 'NV009', 'B008', 'CN2');
INSERT INTO CN2.HDCHINHANH_NV (MAHD, MANV1, MANV2, MABAN, MACN) VALUES
('HD009', 'NV009', 'NV010', 'B009', 'CN2');
INSERT INTO CN2.HDCHINHANH_NV (MAHD, MANV1, MANV2, MABAN, MACN) VALUES
('HD010', 'NV010', 'NV006', 'B010', 'CN2');

-- CTHD
INSERT INTO CN2.CTHD (MAHD, MAMA, SL, DONGIA) VALUES
('HD006', 'MA006', 2, 64000);
INSERT INTO CN2.CTHD (MAHD, MAMA, SL, DONGIA) VALUES
('HD007', 'MA007', 3, 87000);
INSERT INTO CN2.CTHD (MAHD, MAMA, SL, DONGIA) VALUES
('HD008', 'MA008', 2, 90000);
INSERT INTO CN2.CTHD (MAHD, MAMA, SL, DONGIA) VALUES
('HD009', 'MA009', 1, 110000);
INSERT INTO CN2.CTHD (MAHD, MAMA, SL, DONGIA) VALUES
('HD010', 'MA010', 2, 70000);